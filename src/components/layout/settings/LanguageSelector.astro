---
import { languages, getLangFromUrl } from '@/i18n/utils';

const currentLang = getLangFromUrl(Astro.url);
const { pathname } = Astro.url;

/**
 * Genera una nueva ruta reemplazando el segmento del idioma en la URL actual
 * @param lang CÃ³digo del idioma (ej: "en", "es")
 */
const getNewPath = (lang: string) => {
  const parts = pathname.split('/');
  
  parts[1] = lang;
  
  return parts.join('/') || '/';
};
---

<div class="relative inline-block text-left group">
  <button
    id="lang-selector"
    class="flex items-center gap-2 rounded-lg border border-mono-lighter bg-white px-3 py-2 text-sm font-medium text-mono-black transition-all hover:bg-mono-lighter dark:border-mono-dark dark:bg-mono-darker dark:text-mono-white dark:hover:bg-mono-dark"
    aria-haspopup="true"
    aria-expanded="false"
  >
    <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="2" y1="12" x2="22" y2="12"></line>
      <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
    </svg>
    <span class="uppercase">{currentLang}</span>
    <svg class="h-4 w-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </button>

  <div
    class="invisible absolute right-0 mt-2 w-32 origin-top-right rounded-xl border border-mono-lighter bg-white shadow-xl transition-all opacity-0 group-hover:visible group-hover:opacity-100 dark:border-mono-dark dark:bg-mono-darker z-50"
  >
    <div class="p-1">
      {
        Object.entries(languages).map(([code, label]) => (
          <a
            href={getNewPath(code)}
            class={`block rounded-lg px-4 py-2 text-sm transition-colors ${
              currentLang === code
                ? 'bg-accent/10 text-accent font-bold'
                : 'text-mono-dark hover:bg-mono-lighter dark:text-mono-light dark:hover:bg-mono-dark'
            }`}
          >
            {label}
          </a>
        ))
      }
    </div>
  </div>
</div>