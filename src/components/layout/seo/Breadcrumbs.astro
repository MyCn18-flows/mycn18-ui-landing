---
import { getLangFromUrl, useTranslations } from '@/i18n/utils';
import HeaderLink from '../HeaderLink.astro';
import { Icon } from 'astro-icon/components';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const { pathname } = Astro.url;

// 1. Se limpia el path eliminando el prefijo del idioma y barras finales
const pathWithoutLang = pathname.replace(new RegExp(`^/${lang}/?`), '').replace(/\/$/, '');

// 2. Se divide en segmentos
const segments = pathWithoutLang.split('/').filter(segment => segment !== '');

// 3. Se construyen los breadcrumbs
let currentPath = `/${lang}`;
const breadcrumbs = segments.map((segment, index) => {
    currentPath += `/${segment}`;
    const isLast = index === segments.length - 1;
    
    // Se formatea el texto: de "ai-agents" a "Ai agents"
    const label = segment
        .replace(/-/g, ' ')
        .charAt(0).toUpperCase() + segment.slice(1).replace(/-/g, ' ');

    return {
        href: currentPath,
        label: label,
        isLast: isLast
    };
});
---

<nav 
    class="bg-white/50 py-4 backdrop-blur-sm dark:bg-mono-black/50 border-b border-mono-lighter dark:border-mono-dark" 
    aria-label="Breadcrumb"
>
    <ol class="mx-auto flex max-w-7xl list-none items-center justify-start px-4 text-sm sm:px-6 lg:px-8">
        <li class="flex items-center">
            <HeaderLink href={`/${lang}`} class="text-mono-gray hover:text-accent transition-colors">
                <Icon name="heroicons:home" class="h-4 w-4" />
                <span class="sr-only">Home</span>
            </HeaderLink>
        </li>

        {breadcrumbs.map((crumb) => (
            <li class="flex items-center">
                <Icon 
                    name="heroicons:chevron-right" 
                    class="mx-2 h-4 w-4 text-mono-light dark:text-mono-gray" 
                />
                {crumb.isLast ? (
                    <span 
                        aria-current="page" 
                        class="font-bold text-accent"
                    >
                        {crumb.label}
                    </span>
                ) : (
                    <HeaderLink 
                        href={crumb.href} 
                        class="text-mono-gray hover:text-accent"
                    >
                        {crumb.label}
                    </HeaderLink>
                )}
            </li>
        ))}
    </ol>
</nav>